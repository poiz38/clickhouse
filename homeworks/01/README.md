# Отчет: Примеры использования ClickHouse в реальных проектах

В данном отчете рассмотрены кейсы внедрения ClickHouse в крупных технологических компаниях. ClickHouse — это колоночная аналитическая СУБД, предназначенная для онлайн-обработки аналитических запросов (OLAP).

---

## 1. Яндекс (Проект: Яндекс.Метрика)

### Специфика проекта
Яндекс.Метрика — это второй по величине сервис веб-аналитики в мире. Система собирает данные о посещениях сайтов, кликах, скроллах и других действиях пользователей в режиме реального времени. Именно внутри этого проекта и был создан ClickHouse.

### Особенности внедрения и архитектура
*   **Масштаб:** Система обрабатывает десятки триллионов строк. Ежедневно добавляются десятки миллиардов событий.
*   **Отказ от предагрегатов:** До ClickHouse данные хранились в агрегированном виде. Это ограничивало гибкость отчетов. С переходом на ClickHouse появилась возможность строить отчеты по "сырым" данным с любыми фильтрами за доли секунды.
*   **Архитектура:** 
    *   Использование шардирования и репликации (движки `ReplicatedMergeTree`).
    *   Данные распределены по сотням узлов.
    *   Применяется двухуровневое шардирование для обеспечения отказоустойчивости.

**Ссылка на ресурс:** [История создания ClickHouse (Habr)](https://habr.com/ru/company/yandex/blog/273097/)

---

## 2. Cloudflare (Проект: Аналитика HTTP-трафика и DNS)

### Специфика проекта
Cloudflare обеспечивает безопасность и производительность миллионов сайтов. Компании требовалось анализировать огромные потоки логов (HTTP-запросы, атаки, DNS-запросы) в реальном времени, чтобы предоставлять дашборды клиентам.

### Особенности внедрения и архитектура
*   **Замена технологий:** Ранее использовалась связка PostgreSQL + CitusDB, но она перестала справляться с нагрузкой при росте объема данных до миллионов записей в секунду.
*   **Архитектура:**
    *   **Kafka в качестве буфера:** Данные из пограничных узлов попадают в Kafka, откуда ClickHouse забирает их с помощью `Kafka Engine`.
    *   **Сжатие данных:** Благодаря колоночному хранению Cloudflare удалось добиться впечатляющих коэффициентов сжатия (до 10-20 раз), что существенно снизило затраты на дисковое хранилище.
    *   **Query Proxy:** Использование собственного прокси-слоя для маршрутизации запросов к кластерам ClickHouse.

**Ссылка на ресурс:** [How Cloudflare analyzes terabytes of data with ClickHouse](https://blog.cloudflare.com/how-cloudflare-analyzes-terabytes-of-data/)

---

## 3. Авито (Проект: Система наблюдаемости / Observability)

### Специфика проекта
Авито — крупнейший сервис объявлений в России. ClickHouse используется здесь как основное хранилище для метрик и логов всей инфраструктуры (мониторинг).

### Особенности внедрения и архитектура
*   **Единое хранилище:** Вместо использования традиционного Graphite (Whisper) для метрик, Авито перевели хранение метрик в ClickHouse. Это позволило хранить данные дольше и анализировать их быстрее.
*   **Архитектура:**
    *   Использование компонента `graphite-clickhouse` для совместимости со старыми дашбордами Grafana.
    *   Объединение логов (Logs) и метрик (Metrics) в одной СУБД позволяет коррелировать события: например, увидеть всплеск 500-х ошибок и тут же в соседнем запросе посмотреть логи этих ошибок.
    *   Высокая доступность обеспечивается за счет распределенных таблиц (`Distributed tables`).

**Ссылка на ресурс:** [Метрики в Авито: ClickHouse (YouTube)](https://www.youtube.com/watch?v=msVvNisK6mU)

---

## Резюме
Использование ClickHouse оправдано в проектах, где:
1. Требуется анализ огромных объемов "сырых" данных (Big Data).
2. Важна скорость выполнения аналитических запросов в реальном времени (Real-time OLAP).
3. Необходимо эффективное хранение данных (высокая степень сжатия).
4. Нагрузка на чтение преобладает над нагрузкой на изменение/удаление записей.